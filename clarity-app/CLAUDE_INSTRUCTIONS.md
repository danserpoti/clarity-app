# 🎯 CLAUDE_INSTRUCTIONS.md
# Clarity App - ClaudeCode開発指示書

> **⚠️ 重要: 全ての開発作業前に必ずこのファイルを確認してください**
> **📅 最終更新: 2025-08-01**

## 🎯 プロジェクト概要
思考・感情を記録してAI分析により自己理解を深める「脳内整理アプリ」
**プライバシーファースト**の設計で、ユーザーの思考データを完全に保護する。

---

## 🔒 【絶対に変更しない基本方針】（Tier 1 - Core Principles）

### プライバシー・セキュリティ
- **データ主権**: ユーザーの思考データは端末外に出さない
- **ローカル保存のみ**: SQLite等の端末内ストレージのみ使用
- **外部DB禁止**: Supabase, Firebase等の外部データベース使用禁止
- **暗号化**: 端末内でもセンシティブデータは暗号化

### 技術選択
- **Flutter使用**: iOS/Android/Web対応のクロスプラットフォーム
- **オフライン優先**: ネット接続なしでも基本機能が動作
- **AI分析**: OpenAI API使用（データは一時的処理のみ）

### データ連携
- **Notion連携のみ**: バックアップ・同期用途に限定
- **ユーザー制御**: 全ての外部連携はユーザーが制御可能

---

## 🔄 【変更可能な実装詳細】（Tier 2 - Implementation Details）

### UI/UX
- デザインシステム・カラーパレット
- レイアウト・ナビゲーション
- アニメーション・トランジション

### 機能実装
- 機能の追加順序・優先度
- Flutter パッケージの選択
- ローカルDB設計の詳細
- AI分析の詳細仕様

### 開発・デプロイ
- 開発ツール・ワークフロー
- テスト戦略
- リリース方法

---

## 📋 【現在のタスク】（Tier 3 - Current Tasks）

### ✅ Phase 1完了: Next.js版ローカル化
**完了済み**: Next.js + localStorage版（Supabase除去完了）
**成果**: 動作するローカル版プロトタイプ

### 🚀 Phase 2進行中: Flutter版新規開発
**現状**: Phase 1完成版を参考資料として活用
**目標**: Flutter + SQLite版の新規開発
**詳細**: `PHASE2_INSTRUCTIONS.md` を参照

### 開発フェーズ
1. **Flutter プロジェクト初期化**
   - 新規Flutterプロジェクト作成
   - 必要パッケージの導入（sqflite, shared_preferences等）
   
2. **データ層実装**
   - ローカルSQLiteデータベース設計
   - 思考データのCRUD操作
   - データ暗号化機能

3. **UI層実装**
   - 既存Next.js版のUI/UXを参考にFlutterで再実装
   - マテリアルデザイン適用
   - レスポンシブ対応

4. **AI連携**
   - OpenAI API統合（プライバシー配慮）
   - 分析結果のローカル保存
   - ユーザー制御可能な設定

5. **Notion連携**
   - バックアップ機能実装
   - データ同期・復元機能

---

## ⚠️ 【制約・禁止事項】

### 絶対にやってはいけないこと
- ❌ Supabase, Firebase等の外部データベース使用
- ❌ ユーザーの思考データをクラウドに保存
- ❌ 必須の外部サービス依存（Notion以外）
- ❌ プライバシーポリシーに反する実装
- ❌ ユーザーの同意なしのデータ送信

### 注意が必要なこと
- ⚠️ AI API使用時はデータ最小化
- ⚠️ 外部連携は全てオプション化
- ⚠️ エラー時の適切なフォールバック

---

## 🎯 【品質基準・チェックポイント】

### 毎回確認すること
- [ ] プライバシー方針に従っているか？
- [ ] ローカル保存を維持しているか？
- [ ] 外部サービス依存を増やしていないか？
- [ ] ユーザーがデータを完全制御できるか？
- [ ] オフラインでも基本機能が動作するか？

### 変更時の判断基準
- **基本方針（Tier 1）に影響**: 要再検討・ユーザー確認
- **実装詳細（Tier 2）の変更**: OK
- **現在タスク（Tier 3）の調整**: OK

---

## 🔄 【継続的改善プロセス】

### 開発サイクル
1. **実装前**: この指示書の該当Tierを確認
2. **実装中**: 制約事項をチェック
3. **実装後**: 品質基準で検証
4. **フィードバック**: 必要に応じて指示書更新

### エスカレーション
- Tier 1 変更が必要: 必ずユーザーに確認
- 技術的制約で実現困難: 代替案を提示
- 不明な要求: 基本方針に照らして判断

---

## 💡 【参考情報】

### 既存実装
- Next.js版: プロトタイプとしてUI/UX参考に活用
- 実装済み機能: 思考記録、AI分析、データ可視化
- 学習ポイント: UXフロー、データ構造、AI連携方法

### 技術スタック
```
Frontend: Flutter
Local Storage: SQLite + SharedPreferences
Security: flutter_secure_storage
AI: OpenAI API
Backup: Notion API
Charts: fl_chart
State Management: Provider/Riverpod
```

### 開発優先順位
1. データプライバシー確保
2. 基本機能（思考記録・表示）
3. AI分析統合
4. UI/UX改善
5. Notion連携
6. 追加機能

---

## 📞 【重要】困った時の対応

### 判断に迷った場合
1. **基本方針（Tier 1）を最優先**で判断
2. **プライバシー保護**を最重要視
3. **ユーザー制御**を維持
4. **不明な場合は質問**してから実装

### よくある落とし穴
- 「簡単だから」外部サービスを使おうとする
- 「一時的に」クラウドにデータを置こうとする
- 「便利だから」必須機能として外部連携する

**→ これらは全て基本方針違反です**

---

この指示書は、Clarityアプリの開発において**変わらない基本方針**と**柔軟な実装詳細**を明確に分けています。開発中は常にこの指示書を参照し、基本方針を守りながら最適な実装を行ってください。